# Kindle自動テキスト抽出システム

Kindleアプリで開いた書籍を自動でスクリーンショット撮影し、OCRでテキスト抽出を行う自動化ツールです。

## 機能

1. **完全自動化ワークフロー**
   - Kindleアプリを自動で開く
   - 書籍が既に開かれている状態で実行
   - 最初のページが表示されている状態で実行（手動で最初のページに移動する必要があります）
   - 矢印キー方向の自動判定
   - 全ページのスクリーンショットを自動撮影

2. **OCR文字認識**
   - Tesseract OCRを使用
   - 日本語対応
   - 画像からテキストを自動抽出

3. **Google Drive連携**
   - スクリーンショットを自動アップロード
   - 要約結果をGoogle Driveに保存



## システム構成

```
kindle-automatic-summary/
├── run.py                 # 🚀 簡単起動スクリプト（推奨）
├── kindle_automation.py   # メインの自動化スクリプト
├── config.py             # 設定ファイル
├── google_drive_manager.py # Google Drive連携

├── test_automation.py    # テストスクリプト
├── requirements.txt      # Python依存関係
├── setup_guide.md       # 詳細セットアップガイド
├── env_example.txt      # 環境変数設定例
├── .gitignore          # Git除外設定
└── README.md           # このファイル
```

## クイックスタート

### 1. 依存関係のインストール
```bash
pip install -r requirements.txt
```

### 2. Tesseract OCRのインストール
```bash
brew install tesseract tesseract-lang
```

### 3. 環境設定
```bash
cp env_example.txt .env
# .envファイルを編集してAPIキーを設定
```

### 4. 実行（対話的）
```bash
python3 run.py
```

### 5. 従来の実行方法
```bash
python3 kindle_automation.py
```

## 使用方法

### 🚀 推奨：対話的実行（簡単）

#### 実行前の準備
1. **Kindleアプリを起動**
2. **要約したい書籍を開く**
3. **最初のページを表示**（手動で最初のページに移動）
4. **他のアプリを最小化または閉じる**
5. **通知をオフにする**（推奨）
6. **省電力設定を一時的に無効にする**（推奨）

#### 実行手順
```bash
python3 run.py
```

実行すると以下の流れで進みます：
1. **設定確認** - APIキー、Google Drive、OCR設定を確認
2. **書籍タイトル入力** - 要約したい書籍のタイトルを入力
3. **ページ数指定** - 処理するページ数を指定（全ページの場合はEnter）
4. **注意事項確認** - 重要な注意事項を表示
5. **実行確認** - 最終確認（y/N）
6. **カウントダウン** - 5秒のカウントダウン
7. **自動処理実行** - 完全自動化処理開始

### 📋 従来の実行方法
```bash
python3 kindle_automation.py
```

### 🔄 完全自動化フロー

システムは以下の手順で完全自動化を実行します：

1. **Kindleアプリ起動**
   - Amazon Kindleアプリを自動起動
   - アプリを前面に表示

2. **書籍確認**
   - 書籍が既に開かれていることを確認
   - 書籍の最初のページが表示されている状態で実行

3. **最初のページの確認**
   - 書籍の最初のページが表示されていることを確認
   - 手動で最初のページに移動する必要があります
   - プログラムは最初のページが表示されている状態を前提として実行します

4. **矢印キー方向の自動判定**
   - 右矢印キーでページが変わるかテスト
   - 変わらなければ左矢印キーでテスト
   - 適切な方向を自動判定

5. **ページめくり・スクリーンショット撮影**
   - 判定された方向の矢印キーでページめくり
   - 各ページのスクリーンショットを自動撮影
   - 進捗状況をリアルタイム表示

6. **OCR文字認識**
   - 全スクリーンショットからテキストを自動抽出
   - 日本語対応の高精度OCR

7. **Google Drive連携**
   - 全スクリーンショットを自動アップロード
   - 要約結果も自動保存



### 🧪 テスト実行
```bash
python3 test_automation.py
```

各機能を個別にテストできます：
- 設定ファイル読み込み
- スクリーンショット撮影
- OCR文字認識

- Google Drive連携

## 必要な設定



### Google Drive API（オプション）
- Google Cloud Consoleでプロジェクト作成
- Google Drive APIを有効化
- OAuth 2.0認証情報を作成
- `credentials.json`としてダウンロード

## 出力

- **スクリーンショット**: `output/screenshots/`
- **抽出テキスト**: `output/extracted_text.txt`

## 注意事項

### システム要件
- macOS専用（PyAutoGUIの制限）
- Python 3.8以上
- Kindleアプリが事前にインストールされている必要
- 書籍が事前にダウンロードされている必要

### 依存関係の注意事項
- **numpy 2.0系**は互換性問題が発生する可能性があります（推奨: 1.24.3）
- **OpenCV 4.9.x系**は安定性に問題がある場合があります（推奨: 4.8.1.78）
- 問題が発生した場合は、`requirements.txt`のバージョンに戻してください

### 実行時の注意
- アクセシビリティの許可が必要（初回実行時）
- Kindleアプリが事前にインストールされている必要
- 書籍が事前にダウンロードされている必要
- **書籍を事前に開いて最初のページを表示しておく必要**
- **処理中はパソコンの操作を避ける（重要）**
  - マウス操作を避ける
  - キーボード操作を避ける
  - 他のアプリに切り替えない
  - 画面の明度や設定を変更しない
- インターネット接続が必要（Google Drive連携）

### セキュリティ
- APIキーは`.env`ファイルで管理し、Gitにコミットしない
- `credentials.json`や`token.json`も同様に管理

## トラブルシューティング

### よくある問題

#### PyAutoGUIのエラー
- アクセシビリティの許可が必要
- システム環境設定 > セキュリティとプライバシー > プライバシー > アクセシビリティでターミナルを許可

#### OCR精度の問題
- 画面の明度を調整
- フォントサイズを大きくする
- スクリーンショットの品質を確認

#### API接続エラー
- APIキーが正しく設定されているか確認
- インターネット接続を確認
- API利用制限に達していないか確認

詳細なトラブルシューティングは[setup_guide.md](setup_guide.md)を参照してください。

## ライセンス

MIT License

## 貢献

プルリクエストやイシューの報告を歓迎します。 